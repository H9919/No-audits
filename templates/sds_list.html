{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h3><i class="bi bi-file-earmark-text text-success"></i> SDS Library</h3>
    <div>
        <a href="{{ url_for('sds.sds_upload') }}" class="btn btn-primary">
            <i class="bi bi-cloud-upload"></i> Upload SDS
        </a>
        <div class="btn-group ms-2" role="group">
            <button class="btn btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
                <i class="bi bi-gear"></i> Tools
            </button>
            <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#" onclick="showBulkUpload()">
                    <i class="bi bi-upload"></i> Bulk Upload (ZIP)
                </a></li>
                <li><a class="dropdown-item" href="#" onclick="generateLabels()">
                    <i class="bi bi-printer"></i> Generate Labels
                </a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="#" onclick="showExpiredSDS()">
                    <i class="bi bi-calendar-x"></i> Check Expiry
                </a></li>
                <li><a class="dropdown-item" href="#" onclick="showChemicalIndex()">
                    <i class="bi bi-list-ul"></i> Chemical Index
                </a></li>
            </ul>
        </div>
    </div>
</div>

<!-- Quick Stats and Search -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card bg-success text-white">
            <div class="card-body text-center">
                <h4 id="totalSDS">{{ rows|length }}</h4>
                <small>Total SDS</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-info text-white">
            <div class="card-body text-center">
                <h4 id="withEmbeddings">{{ rows|selectattr("has_embeddings", "equalto", true)|list|length }}</h4>
                <small>AI Searchable</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-warning text-white">
            <div class="card-body text-center">
                <h4 id="recentUploads">{{ rows|selectattr("created_ts", "gt", ((moment().valueOf() / 1000) - 2592000))|list|length }}</h4>
                <small>Recent (30d)</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-primary text-white">
            <div class="card-body text-center">
                <h4 id="uniqueChemicals">-</h4>
                <small>Unique Chemicals</small>
            </div>
        </div>
    </div>
</div>

<!-- Enhanced Search Panel -->
<div class="card mb-4">
    <div class="card-header">
        <div class="d-flex justify-content-between align-items-center">
            <h6 class="mb-0"><i class="bi bi-search"></i> Search & Filter</h6>
            <button class="btn btn-sm btn-outline-secondary" onclick="toggleAdvancedSearch()">
                <i class="bi bi-sliders"></i> Advanced
            </button>
        </div>
    </div>
    <div class="card-body">
        <div class="row g-3">
            <div class="col-md-6">
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                    <input type="text" class="form-control" id="quickSearch" 
                           placeholder="Search by product name, CAS number, or chemical...">
                </div>
            </div>
            <div class="col-md-3">
                <select class="form-select" id="hazardFilter">
                    <option value="">All Hazard Types</option>
                    <option value="flammable">Flammable</option>
                    <option value="toxic">Toxic</option>
                    <option value="corrosive">Corrosive</option>
                    <option value="oxidizing">Oxidizing</option>
                    <option value="explosive">Explosive</option>
                </select>
            </div>
            <div class="col-md-3">
                <select class="form-select" id="embedsFilter">
                    <option value="">All SDS</option>
                    <option value="true">AI Searchable Only</option>
                    <option value="false">Non-AI Searchable</option>
                </select>
            </div>
        </div>
        
        <!-- Advanced Search Panel -->
        <div id="advancedSearchPanel" class="mt-3" style="display: none;">
            <hr>
            <div class="row g-3">
                <div class="col-md-4">
                    <label class="form-label">Upload Date Range</label>
                    <div class="input-group">
                        <input type="date" class="form-control" id="uploadDateFrom">
                        <input type="date" class="form-control" id="uploadDateTo">
                    </div>
                </div>
                <div class="col-md-4">
                    <label class="form-label">File Size</label>
                    <select class="form-select" id="fileSizeFilter">
                        <option value="">Any Size</option>
                        <option value="small">Small (&lt; 1MB)</option>
                        <option value="medium">Medium (1-5MB)</option>
                        <option value="large">Large (&gt; 5MB)</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Processing Status</label>
                    <select class="form-select" id="processingFilter">
                        <option value="">All Status</option>
                        <option value="complete">Fully Processed</option>
                        <option value="partial">Partially Processed</option>
                        <option value="failed">Processing Failed</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Main SDS Table -->
<div id="sdsTableContainer">
    <!-- Dynamic table will be rendered here -->
</div>

<!-- Include the dynamic table component -->
{% set table_id = 'sds' %}
{% set table_title = 'Safety Data Sheets' %}
{% include 'components/dynamic_table.html' %}

<!-- Modals -->
<div class="modal fade" id="bulkUploadModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Bulk Upload SDS</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form action="{{ url_for('sds.sds_upload') }}" method="post" enctype="multipart/form-data">
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Select ZIP file containing multiple SDS documents</label>
                        <input type="file" class="form-control" name="file" accept=".zip" required>
                    </div>
                    <div class="alert alert-info">
                        <h6><i class="bi bi-info-circle"></i> Bulk Upload Tips</h6>
                        <ul class="mb-0">
                            <li>ZIP file should contain only PDF files</li>
                            <li>File names should be descriptive (e.g., "Acetone_SDS.pdf")</li>
                            <li>Maximum 50 files per ZIP</li>
                            <li>Each PDF should be under 10MB</li>
                        </ul>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Upload ZIP</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="chemicalIndexModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Chemical Index</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="input-group mb-3">
                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                    <input type="text" class="form-control" id="chemicalSearchInput" 
                           placeholder="Search chemicals...">
                </div>
                <div id="chemicalIndexList">
                    <!-- Populated dynamically -->
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="sdsPreviewModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="previewTitle">SDS Preview</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-8">
                        <div id="sdsPreviewContent">
                            <!-- SDS content preview -->
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">Quick Info</h6>
                            </div>
                            <div class="card-body" id="sdsQuickInfo">
                                <!-- Quick info will be populated -->
                            </div>
                        </div>
                        
                        <div class="card mt-3">
                            <div class="card-header">
                                <h6 class="mb-0">AI Chat</h6>
                            </div>
                            <div class="card-body">
                                <div id="chatMessages" style="height: 200px; overflow-y: auto;" class="mb-3">
                                    <!-- Chat messages -->
                                </div>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="chatInput" 
                                           placeholder="Ask about this SDS...">
                                    <button class="btn btn-primary" onclick="sendChatMessage()">
                                        <i class="bi bi-send"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <a href="#" id="downloadSdsBtn" class="btn btn-outline-primary">
                    <i class="bi bi-download"></i> Download
                </a>
                <a href="#" id="printLabelBtn" class="btn btn-outline-secondary">
                    <i class="bi bi-printer"></i> Print Label
                </a>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // SDS data from server
    const sdsData = {{ rows|tojson }};
    
    // Enhanced column configuration
    const sdsColumns = [
        {
            key: 'id',
            label: 'SDS ID',
            type: 'custom',
            filterable: true,
            sortable: true,
            format: (value) => `<code>${value}</code>`
        },
        {
            key: 'product_name',
            label: 'Product Name',
            type: 'custom',
            filterable: true,
            sortable: true,
            format: (value, row) => {
                const hasAI = row.has_embeddings ? 
                    '<i class="bi bi-robot text-primary ms-1" title="AI Searchable"></i>' : '';
                return `<strong>${value}</strong>${hasAI}`;
            }
        },
        {
            key: 'chemical_info',
            label: 'CAS Numbers',
            type: 'custom',
            filterable: true,
            sortable: false,
            format: (value) => {
                if (!value || !value.cas_numbers || value.cas_numbers.length === 0) {
                    return '<span class="text-muted">No CAS</span>';
                }
                const displayCAS = value.cas_numbers.slice(0, 2).map(cas => 
                    `<span class="badge bg-light text-dark">${cas}</span>`
                ).join(' ');
                const extra = value.cas_numbers.length > 2 ? 
                    ` <small class="text-muted">+${value.cas_numbers.length - 2} more</small>` : '';
                return displayCAS + extra;
            }
        },
        {
            key: 'file_name',
            label: 'File',
            type: 'custom',
            filterable: true,
            sortable: true,
            format: (value, row) => {
                const size = row.file_size ? 
                    ` <small class="text-muted">(${(row.file_size / 1024 / 1024).toFixed(1)}MB)</small>` : '';
                return `${value}${size}`;
            }
        },
        {
            key: 'created_ts',
            label: 'Upload Date',
            type: 'custom',
            filterable: true,
            sortable: true,
            format: (value) => {
                const date = new Date(value * 1000);
                const now = new Date();
                const diffDays = Math.floor((now - date) / (1000 * 60 * 60 * 24));
                
                let badge = '';
                if (diffDays <= 7) {
                    badge = ' <span class="badge bg-success">New</span>';
                } else if (diffDays <= 30) {
                    badge = ' <span class="badge bg-info">Recent</span>';
                }
                
                return date.toLocaleDateString() + badge;
            }
        },
        {
            key: 'processing_metadata',
            label: 'Processing',
            type: 'custom',
            filterable: false,
            sortable: false,
            format: (value, row) => {
                const chunks = value?.chunks_count || 0;
                const hasEmbeddings = row.has_embeddings;
                const tables = value?.tables_extracted || 0;
                
                return `
                    <div class="small">
                        <div>${chunks} chunks ${hasEmbeddings ? '✓' : '✗'} AI</div>
                        <div class="text-muted">${tables} tables extracted</div>
                    </div>
                `;
            }
        },
        {
            key: 'chemical_info.hazard_statements',
            label: 'Hazards',
            type: 'custom',
            filterable: false,
            sortable: false,
            format: (value, row) => {
                const hazards = row.chemical_info?.hazard_statements || [];
                if (hazards.length === 0) return '<span class="text-muted">None listed</span>';
                
                const displayHazards = hazards.slice(0, 2).map(h => {
                    const hCode = h.match(/H\d{3}/)?.[0] || '';
                    return `<span class="badge bg-warning text-dark" title="${h}">${hCode}</span>`;
                }).join(' ');
                
                const extra = hazards.length > 2 ? 
                    ` <small class="text-muted">+${hazards.length - 2}</small>` : '';
                return displayHazards + extra;
            }
        },
        {
            key: 'actions',
            label: 'Actions',
            type: 'custom',
            filterable: false,
            sortable: false,
            format: (value, row) => `
                <div class="btn-group btn-group-sm">
                    <button class="btn btn-primary" onclick="previewSDS('${row.id}')" title="Preview">
                        <i class="bi bi-eye"></i>
                    </button>
                    <a class="btn btn-outline-secondary" href="/sds/${row.id}/download" title="Download">
                        <i class="bi bi-download"></i>
                    </a>
                    ${row.has_embeddings ? `
                        <a class="btn btn-outline-info" href="/sds/${row.id}/chat" title="AI Chat">
                            <i class="bi bi-robot"></i>
                        </a>
                    ` : ''}
                    <a class="btn btn-outline-success" href="/sds/${row.id}/qr" title="QR Code">
                        <i class="bi bi-qr-code"></i>
                    </a>
                    <div class="btn-group">
                        <button class="btn btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
                            <i class="bi bi-three-dots"></i>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/sds/${row.id}/label">
                                <i class="bi bi-tag"></i> Generate Label
                            </a></li>
                            <li><a class="dropdown-item" href="#" onclick="addToWorkspace('${row.id}')">
                                <i class="bi bi-plus-square"></i> Add to Workspace
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item text-warning" href="#" onclick="reprocessSDS('${row.id}')">
                                <i class="bi bi-arrow-clockwise"></i> Reprocess
                            </a></li>
                        </ul>
                    </div>
                </div>
            `
        }
    ];
    
    // Initialize the dynamic table
    const table = initTable('sds', sdsData, sdsColumns, {
        sortable: true,
        filterable: true,
        paginated: true,
        exportable: true,
        persistPreferences: true,
        defaultSort: { column: 'created_ts', direction: 'desc' }
    });
    
    // Setup enhanced search
    setupEnhancedSearch();
    
    // Calculate unique chemicals
    calculateUniqueChemicals();
    
    // Setup event listeners
    document.getElementById('quickSearch').addEventListener('input', performQuickSearch);
    document.getElementById('hazardFilter').addEventListener('change', applyFilters);
    document.getElementById('embedsFilter').addEventListener('change', applyFilters);
});

function setupEnhancedSearch() {
    const searchInput = document.getElementById('quickSearch');
    let searchTimeout;
    
    searchInput.addEventListener('input', function() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
            performQuickSearch();
        }, 300);
    });
}

function performQuickSearch() {
    const query = document.getElementById('quickSearch').value.toLowerCase();
    const hazardFilter = document.getElementById('hazardFilter').value;
    const embedsFilter = document.getElementById('embedsFilter').value;
    
    const table = tableInstances['sds'];
    if (!table) return;
    
    let filteredData = [...table.data];
    
    // Apply text search
    if (query) {
        filteredData = filteredData.filter(item => {
            const searchFields = [
                item.product_name,
                item.file_name,
                ...(item.chemical_info?.cas_numbers || []),
                ...(item.chemical_info?.hazard_statements || [])
            ].join(' ').toLowerCase();
            
            return searchFields.includes(query);
        });
    }
    
    // Apply hazard filter
    if (hazardFilter) {
        filteredData = filteredData.filter(item => {
            const hazards = (item.chemical_info?.hazard_statements || []).join(' ').toLowerCase();
            return hazards.includes(hazardFilter.toLowerCase());
        });
    }
    
    // Apply embeddings filter
    if (embedsFilter) {
        const hasEmbeddings = embedsFilter === 'true';
        filteredData = filteredData.filter(item => item.has_embeddings === hasEmbeddings);
    }
    
    table.filteredData = filteredData;
    table.currentPage = 1;
    table.render();
    
    // Update stats
    updateFilteredStats(filteredData);
}

function updateFilteredStats(filteredData) {
    document.getElementById('totalSDS').textContent = filteredData.length;
    document.getElementById('withEmbeddings').textContent = 
        filteredData.filter(item => item.has_embeddings).length;
    
    const thirtyDaysAgo = (Date.now() / 1000) - (30 * 24 * 60 * 60);
    document.getElementById('recentUploads').textContent = 
        filteredData.filter(item => item.created_ts > thirtyDaysAgo).length;
}

function calculateUniqueChemicals() {
    const allCAS = new Set();
    sdsData.forEach(sds => {
        if (sds.chemical_info?.cas_numbers) {
            sds.chemical_info.cas_numbers.forEach(cas => allCAS.add(cas));
        }
    });
    document.getElementById('uniqueChemicals').textContent = allCAS.size;
}

function toggleAdvancedSearch() {
    const panel = document.getElementById('advancedSearchPanel');
    panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
}

// Modal Functions
function showBulkUpload() {
    const modal = new bootstrap.Modal(document.getElementById('bulkUploadModal'));
    modal.show();
}

function showChemicalIndex() {
    const modal = new bootstrap.Modal(document.getElementById('chemicalIndexModal'));
    modal.show();
    populateChemicalIndex();
}

function populateChemicalIndex() {
    const chemicalMap = new Map();
    
    sdsData.forEach(sds => {
        if (sds.chemical_info?.cas_numbers) {
            sds.chemical_info.cas_numbers.forEach(cas => {
                if (!chemicalMap.has(cas)) {
                    chemicalMap.set(cas, []);
                }
                chemicalMap.get(cas).push({
                    id: sds.id,
                    product_name: sds.product_name,
                    file_name: sds.file_name
                });
            });
        }
    });
    
    const container = document.getElementById('chemicalIndexList');
    const sortedCAS = Array.from(chemicalMap.keys()).sort();
    
    container.innerHTML = sortedCAS.map(cas => {
        const products = chemicalMap.get(cas);
        return `
            <div class="card mb-2">
                <div class="card-body">
                    <h6 class="card-title">${cas}</h6>
                    <div class="row">
                        ${products.map(product => `
                            <div class="col-md-6 mb-1">
                                <a href="/sds/${product.id}" class="text-decoration-none">
                                    <small>${product.product_name}</small>
                                </a>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
        `;
    }).join('');
}

function previewSDS(sdsId) {
    const sds = sdsData.find(s => s.id === sdsId);
    if (!sds) return;
    
    // Set modal title
    document.getElementById('previewTitle').textContent = sds.product_name;
    
    // Set download link
    document.getElementById('downloadSdsBtn').href = `/sds/${sdsId}/download`;
    document.getElementById('printLabelBtn').href = `/sds/${sdsId}/label`;
    
    // Populate quick info
    const quickInfo = document.getElementById('sdsQuickInfo');
    quickInfo.innerHTML = `
        <div class="mb-2"><strong>File:</strong> ${sds.file_name}</div>
        <div class="mb-2"><strong>Size:</strong> ${sds.text_len ? Math.round(sds.text_len / 1024) + 'KB' : 'Unknown'}</div>
        <div class="mb-2"><strong>Uploaded:</strong> ${new Date(sds.created_ts * 1000).toLocaleDateString()}</div>
        ${sds.chemical_info?.cas_numbers?.length ? `
            <div class="mb-2"><strong>CAS:</strong><br>
                ${sds.chemical_info.cas_numbers.slice(0, 3).map(cas => 
                    `<span class="badge bg-secondary me-1">${cas}</span>`
                ).join('')}
            </div>
        ` : ''}
        ${sds.chemical_info?.hazard_statements?.length ? `
            <div class="mb-2"><strong>Hazards:</strong><br>
                <div class="small">${sds.chemical_info.hazard_statements.slice(0, 2).join('<br>')}</div>
            </div>
        ` : ''}
    `;
    
    // Clear chat
    document.getElementById('chatMessages').innerHTML = `
        <div class="alert alert-info small">
            ${sds.has_embeddings ? 
                'Ask me anything about this SDS document!' : 
                'AI chat not available for this document.'}
        </div>
    `;
    
    // Setup chat if available
    if (sds.has_embeddings) {
        setupSDSChat(sdsId);
    }
    
    // Show modal
    const modal = new bootstrap.Modal(document.getElementById('sdsPreviewModal'));
    modal.show();
}

function setupSDSChat(sdsId) {
    const chatInput = document.getElementById('chatInput');
    const chatMessages = document.getElementById('chatMessages');
    
    chatInput.disabled = false;
    chatInput.placeholder = 'Ask about this SDS...';
    
    // Add enter key listener
    chatInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            sendChatMessage();
        }
    });
    
    window.currentSDSId = sdsId;
}

function sendChatMessage() {
    const input = document.getElementById('chatInput');
    const message = input.value.trim();
    
    if (!message || !window.currentSDSId) return;
    
    // Add user message
    addChatMessage(message, 'user');
    input.value = '';
    
    // Show typing indicator
    addChatMessage('Thinking...', 'bot', true);
    
    // Send to SDS chat endpoint
    fetch(`/sds/${window.currentSDSId}/chat`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: `question=${encodeURIComponent(message)}`
    })
    .then(response => response.text())
    .then(html => {
        // Remove typing indicator
        const typingMsg = document.querySelector('.typing-indicator');
        if (typingMsg) typingMsg.remove();
        
        // Extract answer from HTML response (simplified)
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        const answerElement = doc.querySelector('pre');
        const answer = answerElement ? answerElement.textContent : 'Sorry, I could not process your question.';
        
        addChatMessage(answer, 'bot');
    })
    .catch(error => {
        const typingMsg = document.querySelector('.typing-indicator');
        if (typingMsg) typingMsg.remove();
        
        addChatMessage('Sorry, there was an error processing your question.', 'bot');
        console.error('Chat error:', error);
    });
}

function addChatMessage(message, sender, isTyping = false) {
    const chatMessages = document.getElementById('chatMessages');
    const messageDiv = document.createElement('div');
    messageDiv.className = `mb-2 ${isTyping ? 'typing-indicator' : ''}`;
    
    if (sender === 'user') {
        messageDiv.innerHTML = `
            <div class="text-end">
                <div class="badge bg-primary">${message}</div>
            </div>
        `;
    } else {
        messageDiv.innerHTML = `
            <div class="text-start">
                <div class="alert alert-light small mb-0">${message}</div>
            </div>
        `;
    }
    
    chatMessages.appendChild(messageDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

// Additional Functions
function generateLabels() {
    const selectedIds = getSelectedSDSIds();
    if (selectedIds.length === 0) {
        alert('Please select SDS documents to generate labels for.');
        return;
    }
    
    // Implementation for bulk label generation
    console.log('Generating labels for:', selectedIds);
}

function showExpiredSDS() {
    // Implementation for checking expired SDS
    alert('Expired SDS check would be implemented here.');
}

function addToWorkspace(sdsId) {
    // Implementation for adding to workspace
    console.log('Adding to workspace:', sdsId);
    alert('SDS added to workspace!');
}

function reprocessSDS(sdsId) {
    if (confirm('Reprocess this SDS document? This will update the AI search capabilities.')) {
        // Implementation for reprocessing
        console.log('Reprocessing SDS:', sdsId);
    }
}

function getSelectedSDSIds() {
    // Implementation for getting selected rows
    return [];
}

// Global functions
window.previewSDS = previewSDS;
window.addToWorkspace = addToWorkspace;
window.reprocessSDS = reprocessSDS;
window.sendChatMessage = sendChatMessage;
</script>

<style>
.card h4 {
    font-size: 1.5rem;
    font-weight: 600;
}

.card small {
    font-size: 0.875rem;
    opacity: 0.9;
}

.badge {
    font-size: 0.75rem;
}

.btn-group-sm .btn {
    padding: 0.25rem 0.5rem;
    font-size: 0.875rem;
}

.table-hover tbody tr:hover {
    background-color: rgba(0, 0, 0, 0.025);
}

#chemicalIndexList {
    max-height: 400px;
    overflow-y: auto;
}

#chatMessages {
    background-color: #f8f9fa;
    border-radius: 0.375rem;
    padding: 0.75rem;
}

.typing-indicator {
    opacity: 0.7;
}

.alert-light {
    background-color: #ffffff;
    border: 1px solid #e9ecef;
}

@media (max-width: 768px) {
    .btn-group {
        flex-direction: column;
        width: 100%;
    }
    
    .btn-group .btn {
        border-radius: 0.375rem !important;
        margin-bottom: 0.25rem;
    }
    
    .card h4 {
        font-size: 1.25rem;
    }
    
    .modal-xl {
        max-width: 95%;
    }
}
</style>
{% endblock %}
